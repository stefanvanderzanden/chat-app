<div
    id="room-detail-content"
    data-active-room-id="room-{{ room.id }}"
    class="flex flex-col h-full"
    >
    <header class="pb-4 border-b border-gray-200">
        <h2 class="text-2xl font-bold text-gray-800">{{ room.name }}</h2>
    </header>

    <!-- Chat log -->
    <div id="chat-container"
         class="flex-1 overflow-y-auto mt-4 bg-white border border-gray-200 rounded-lg p-4 space-y-2 shadow-sm">
        <ul id="chat-log" class="space-y-2">
            {% for message in messages %}
            <li class="text-sm text-gray-700">
                <span class="font-semibold">{{ message.user.email }}</span>:
                {{ message.text }}
                <span class="text-xs text-gray-400 ml-2">[{{ message.timestamp|date:"H:i" }}]</span>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Chat form -->
    <form id="chat-form" class="mt-4 flex space-x-2" action="javascript:void(0);">
        <input id="chat-message-input"
               type="text"
               placeholder="Typ je bericht..."
               class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-indigo-200 focus:outline-none"
               autocomplete="off">
        <button type="submit"
                class="px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition">
            Verstuur
        </button>
    </form>
</div>

<script>
    const roomId = "{{ room.id|escapejs }}";
    const chatLog = document.querySelector("#chat-log");
    const messageInput = document.querySelector("#chat-message-input");

    // ðŸ“¥ Luister naar globale socket events
    document.addEventListener("chatEvent", e => {
        console.log('EVENTLISTERNER chat')

        const data = e.detail;
        if (data.type === "chat_message" && data.room_id == roomId) {
            const div = document.createElement("div");
            div.className = "text-sm text-gray-700";
            div.innerHTML = `<span class="font-semibold">${data.user}</span>: ${data.message}
                <span class="text-xs text-gray-400 ml-2">[${new Date().toLocaleTimeString()}]</span>`;
            chatLog.appendChild(div);
            chatLog.scrollTop = chatLog.scrollHeight;
        }
    });

    // ðŸ“¤ Verstuur nieuw bericht
    document.querySelector("#chat-form").addEventListener("submit", function(e) {
        e.preventDefault();
        if (messageInput.value.trim() === "") return;

        sendMessage(roomId, messageInput.value);
        messageInput.value = "";
    });

    // âœ… Markeer gelezen zodra je de room opent
    markAsRead(roomId);
</script>

{#<script>#}
{#    const roomId = "{{ room.id|escapejs }}";#}
{#    const chatLog = document.querySelector("#chat-log");#}
{#    const messageInput = document.querySelector("#chat-message-input");#}
{##}
{#    // luister naar globale chat events#}
{#    document.addEventListener("chatMessage", e => {#}
{#        const data = e.detail;#}
{#        if (data.room_id === roomId) {#}
{#            const li = document.createElement("li");#}
{#            li.className = "text-sm text-gray-700";#}
{#            li.innerHTML = `<span class="font-semibold">${data.user}</span>: ${data.message}`;#}
{#            chatLog.appendChild(li);#}
{#            chatLog.scrollTop = chatLog.scrollHeight;#}
{#        } else {#}
{#            // hier kun je je sidebar badge updaten#}
{#        }#}
{#    });#}
{##}
{#    document.querySelector("#chat-form").addEventListener("submit", function(e) {#}
{#        e.preventDefault();#}
{#        if (messageInput.value.trim() === "") return;#}
{##}
{#        sendMessage(roomId, messageInput.value); // via globale functie#}
{#        messageInput.value = "";#}
{#    });#}
{#</script>#}
